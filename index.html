<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hello Rocket 8bit</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      background: #090e23;
      margin: 0;
      padding: 0;
      font-family: 'Press Start 2P', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #adff2f;
    }
    #game {
      background: #090e23;
      box-shadow: 0 0 40px #0a0, 0 0 12px #000;
      margin-bottom: 18px;
      margin-top: 40px;
      display: block;
      outline: none;
      border: none;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="520" tabindex="1"></canvas>
<script>
const FONT_FAMILY = `"Press Start 2P", monospace`;
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const WIDTH = canvas.width;
const HEIGHT = canvas.height;

// Sprites
const rocketImg = new Image();
rocketImg.src = 'https://i.imgur.com/I0s0bng.png';
const alienSpriteSrcs = [
  'https://i.imgur.com/OcVpivo.png',
  'https://i.imgur.com/3D84JpY.png',
  'https://i.imgur.com/UjsDbMw.png'
];
const alienSprites = alienSpriteSrcs.map(src => {
  const img = new Image();
  img.src = src;
  return img;
});

// State
let score = 0;
let coinCount = 0;
let lives = 3;
let level = 1;
let alienSpeed = 0.7;
let gameOver = false;
let gameStarted = false;
let startBtnEnabled = false;

// Player
const player = {
  x: WIDTH/2 - 16,
  y: HEIGHT - 64,
  w: 40,
  h: 46,
  targetX: WIDTH/2 - 16,
};

let bullets = [];
let aliens = [];
let stars = [];
let coins = [];

// Asset loader
let assetsLoaded = 0;
const totalAssets = 1 + alienSprites.length;
function onAssetLoad() {
  assetsLoaded++;
  if (assetsLoaded === totalAssets) {
    startBtnEnabled = true;
  }
}
rocketImg.onload = onAssetLoad;
alienSprites.forEach(img => img.onload = onAssetLoad);

// GAME LOGIC
function spawnAliens() {
  aliens = [];
  const rows = 3 + Math.min(level, 4);
  const cols = 6 + Math.floor(level * 1.1);
  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < cols; col++) {
      aliens.push({
        x: 32 + col * 64,
        y: 24 + row * 44,
        w: 36,
        h: 38,
        dx: alienSpeed,
        dir: 1,
        sprite: alienSprites[Math.floor(Math.random() * alienSprites.length)]
      });
    }
  }
}
function spawnStars() {
  stars = [];
  for (let i = 0; i < 64; i++) {
    stars.push({ x: Math.random() * WIDTH, y: Math.random() * HEIGHT, r: Math.random() * 1.5 + 0.5 });
  }
}
function drawStars() {
  ctx.save();
  ctx.globalAlpha = 0.7;
  ctx.fillStyle = '#fff';
  stars.forEach(s => {
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
    ctx.fill();
  });
  ctx.restore();
}
function drawPlayer() {
  ctx.drawImage(rocketImg, player.x, player.y, player.w, player.h);
}
function drawAliens() {
  aliens.forEach(a => {
    ctx.drawImage(a.sprite, a.x, a.y, a.w, a.h);
  });
}
function drawBullets() {
  ctx.fillStyle = '#adff2f';
  bullets.forEach(b => ctx.fillRect(b.x, b.y, 3, 14));
}
// Desenha moedas douradas/prateadas com pulse
function drawCoins() {
  let time = performance.now() * 0.005;
  let pulse = 1 + Math.sin(time * 2) * 0.12;
  coins.forEach(c => {
    ctx.save();
    ctx.beginPath();
    ctx.arc(c.x + c.w/2, c.y + c.h/2, c.w/2 * pulse, 0, Math.PI*2);
    let coinGradient = ctx.createRadialGradient(
      c.x + c.w/2, c.y + c.h/2, c.w/5,
      c.x + c.w/2, c.y + c.h/2, c.w/2 * pulse
    );
    coinGradient.addColorStop(0, "#fffbe0");
    coinGradient.addColorStop(0.45, "#ffe066");
    coinGradient.addColorStop(0.75, "#ffd700");
    coinGradient.addColorStop(1, "#bba120");
    ctx.fillStyle = coinGradient;
    ctx.shadowColor = "#fffcd0";
    ctx.shadowBlur = 8;
    ctx.fill();
    // Detalhe metálico
    ctx.globalAlpha = 0.18;
    ctx.beginPath();
    ctx.arc(c.x + c.w/2 - 3, c.y + c.h/2 - 2, c.w/4, 0, Math.PI*2);
    ctx.fillStyle = "#fff";
    ctx.fill();
    ctx.restore();
    // Contorno
    ctx.save();
    ctx.globalAlpha = 0.25;
    ctx.beginPath();
    ctx.arc(c.x + c.w/2, c.y + c.h/2, c.w/2 * pulse + 2, 0, Math.PI*2);
    ctx.strokeStyle = "#fffcd0";
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.restore();
  });
}
function drawHUD() {
  ctx.fillStyle = '#adff2f';
  ctx.font = `18px ${FONT_FAMILY}`;
  ctx.fillText(`SCORE: ${score}`, 22, 30);
  ctx.fillText(`COINS: ${coinCount}`, 220, 30);
  ctx.fillText(`LIVES: ${lives}`, 430, 30);
  ctx.fillText(`LEVEL: ${level}`, 610, 30);
}
function drawGameOver() {
  ctx.save();
  ctx.globalAlpha = 0.95;
  ctx.fillStyle = "#090e23cc";
  ctx.fillRect(0, HEIGHT/2-90, WIDTH, 180);
  ctx.globalAlpha = 1;
  ctx.fillStyle = "#ff0040";
  ctx.font = `36px ${FONT_FAMILY}`;
  ctx.textAlign = 'center';
  ctx.fillText("GAME OVER", WIDTH/2, HEIGHT/2-16);
  ctx.font = `20px ${FONT_FAMILY}`;
  ctx.fillStyle = "#adff2f";
  ctx.fillText('Clique ou pressione [R] para reiniciar', WIDTH/2, HEIGHT/2+36);
  ctx.textAlign = 'start';
  ctx.restore();
}

// START SCREEN
function drawStartScreen() {
  ctx.clearRect(0, 0, WIDTH, HEIGHT);
  drawStars();

  // Pulse no título: variação de tamanho + leve variação de cor/gradiente
  let t = performance.now() * 0.002;
  let pulse = 1 + Math.sin(t * 2.2) * 0.10;
  let fontSize = 56 * pulse;
  ctx.save();
  ctx.font = `${fontSize}px ${FONT_FAMILY}`;
  ctx.textAlign = "center";
  // Arcade gradient com variação sutil
  let grad = ctx.createLinearGradient(WIDTH/2-180, HEIGHT/2-80, WIDTH/2+180, HEIGHT/2+10);
  grad.addColorStop(0, "#fffcae");
  grad.addColorStop(0.3 + 0.1*Math.sin(t), "#ffe770");
  grad.addColorStop(1, "#ffe26e");
  ctx.fillStyle = grad;
  ctx.lineWidth = 6;
  ctx.strokeStyle = "#222";
  ctx.shadowColor = "#f4e700";
  ctx.shadowBlur = 10 + 12 * pulse;
  ctx.strokeText("HELLO ROCKET", WIDTH/2, HEIGHT/2 - 48);
  ctx.fillText("HELLO ROCKET", WIDTH/2, HEIGHT/2 - 48);
  ctx.restore();

  // Botão Start Game menor e proporcional
  if (startBtnEnabled) {
    let btnW = 160, btnH = 38;
    let btnX = WIDTH/2 - btnW/2;
    let btnY = HEIGHT/2 + 10;
    ctx.save();
    ctx.globalAlpha = 1;
    ctx.fillStyle = "#adff2f";
    ctx.strokeStyle = "#090e23";
    ctx.lineWidth = 5;
    ctx.beginPath();
    ctx.roundRect(btnX, btnY, btnW, btnH, 8);
    ctx.fill();
    ctx.shadowColor = "#cfff6b";
    ctx.shadowBlur = 5;
    ctx.stroke();
    ctx.font = `13px ${FONT_FAMILY}`;
    ctx.fillStyle = "#090e23";
    ctx.textAlign = "center";
    ctx.shadowBlur = 0;
    ctx.fillText("START GAME", WIDTH/2, btnY + btnH/2 + 6);
    ctx.restore();
  } else {
    ctx.save();
    ctx.font = `18px ${FONT_FAMILY}`;
    ctx.fillStyle = "#adff2f";
    ctx.textAlign = "center";
    ctx.fillText("CARREGANDO...", WIDTH/2, HEIGHT/2 + 42);
    ctx.restore();
  }
}

let startBtnArea = {
  x: WIDTH/2 - 80, y: HEIGHT/2 + 10, w: 160, h: 38
};
function insideStartBtn(mx, my) {
  return (
    startBtnEnabled &&
    mx >= startBtnArea.x &&
    mx <= startBtnArea.x + startBtnArea.w &&
    my >= startBtnArea.y &&
    my <= startBtnArea.y + startBtnArea.h
  );
}
function introLoop() {
  if (!gameStarted) {
    drawStartScreen();
    requestAnimationFrame(introLoop);
  }
}

// GAME FLOW
function fireBullet() {
  if (!gameOver && bullets.length < 6) {
    bullets.push({x: player.x + player.w/2 - 1.5, y: player.y - 10});
  }
}
function endGame() {
  gameOver = true;
  gameStarted = false;
}
function restartGame() {
  score = 0;
  lives = 3;
  coinCount = 0;
  level = 1;
  alienSpeed = 0.7;
  bullets = [];
  coins = [];
  gameOver = false;
  gameStarted = true;
  spawnStars();
  spawnAliens();
  player.x = WIDTH/2 - 16;
  player.targetX = WIDTH/2 - 16;
  loop();
}
function loop() {
  if (!gameStarted) return;
  if (!gameOver) {
    update();
    draw();
    requestAnimationFrame(loop);
  } else {
    draw();
  }
}

// CONTROLES
canvas.addEventListener('mousemove', (e) => {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  if (!gameStarted && startBtnEnabled) {
    canvas.style.cursor = insideStartBtn(mouseX, mouseY) ? 'pointer' : 'default';
  } else {
    player.targetX = mouseX - player.w/2;
    canvas.style.cursor = 'default';
  }
});
canvas.addEventListener('click', (e) => {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  if (!gameStarted && startBtnEnabled && insideStartBtn(mouseX, mouseY)) {
    gameStarted = true;
    spawnStars();
    spawnAliens();
    player.x = WIDTH/2 - 16;
    player.targetX = WIDTH/2 - 16;
    score = 0;
    coinCount = 0;
    lives = 3;
    level = 1;
    alienSpeed = 0.7;
    bullets = [];
    coins = [];
    gameOver = false;
    loop();
    return;
  }
  if (gameOver && gameStarted === false) {
    restartGame();
    return;
  }
  if (gameStarted && !gameOver) {
    fireBullet();
  }
});
window.addEventListener('keydown', (e) => {
  if (e.code === "Space" && gameStarted && !gameOver) fireBullet();
  if (e.key.toLowerCase() === "r" && gameOver) restartGame();
});
canvas.addEventListener('touchstart', e => {
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  const mx = touch.clientX - rect.left;
  const my = touch.clientY - rect.top;
  if (!gameStarted && startBtnEnabled && insideStartBtn(mx, my)) {
    gameStarted = true;
    spawnStars();
    spawnAliens();
    player.x = WIDTH/2 - 16;
    player.targetX = WIDTH/2 - 16;
    score = 0;
    coinCount = 0;
    lives = 3;
    level = 1;
    alienSpeed = 0.7;
    bullets = [];
    coins = [];
    gameOver = false;
    loop();
    return;
  }
  if (gameOver && gameStarted === false) {
    restartGame();
    return;
  }
  if (gameStarted && !gameOver) fireBullet();
  e.preventDefault();
}, {passive:false});
canvas.addEventListener('touchmove', e => {
  if (gameStarted && !gameOver) {
    const rect = canvas.getBoundingClientRect();
    player.targetX = e.touches[0].clientX - rect.left - player.w/2;
  }
});

// GAME UPDATE
function updateAliens() {
  let hitEdge = false;
  aliens.forEach(a => {
    a.x += a.dx * a.dir;
    if (a.x < 8 || a.x + a.w > WIDTH-8) hitEdge = true;
  });
  if (hitEdge) {
    aliens.forEach(a => {
      a.dir *= -1;
      a.y += 32;
      if (a.y + a.h >= player.y) {
        lives--;
        if (lives <= 0) endGame();
        spawnAliens();
      }
    });
  }
}
function updateBullets() {
  for (let i = bullets.length-1; i>=0; i--) {
    bullets[i].y -= 11;
    if (bullets[i].y < -12) bullets.splice(i, 1);
  }
}
function updateCoins() {
  for (let i = coins.length-1; i>=0; i--) {
    coins[i].y += 4;
    if (
      coins[i].x < player.x + player.w &&
      coins[i].x + coins[i].w > player.x &&
      coins[i].y < player.y + player.h &&
      coins[i].y + coins[i].h > player.y
    ) {
      coins.splice(i, 1);
      coinCount++;
      score += 25;
    } else if (coins[i].y > HEIGHT+20) {
      coins.splice(i, 1);
    }
  }
}
function checkCollisions() {
  for (let bi = bullets.length-1; bi>=0; bi--) {
    let b = bullets[bi];
    for (let ai = aliens.length-1; ai>=0; ai--) {
      let a = aliens[ai];
      if (
        b.x < a.x + a.w &&
        b.x + 3 > a.x &&
        b.y < a.y + a.h &&
        b.y + 14 > a.y
      ) {
        bullets.splice(bi, 1);
        aliens.splice(ai, 1);
        score += 100;
        coins.push({x: a.x + a.w/2 - 9, y: a.y + a.h/2 - 9, w: 18, h: 18});
        break;
      }
    }
  }
  for (let ai = aliens.length-1; ai>=0; ai--) {
    let a = aliens[ai];
    if (
      a.x < player.x + player.w &&
      a.x + a.w > player.x &&
      a.y + a.h > player.y + 4
    ) {
      lives--;
      if (lives <= 0) endGame();
      spawnAliens();
      break;
    }
  }
}
function update() {
  if (typeof player.targetX !== 'undefined') {
    const dx = player.targetX - player.x;
    player.x += dx * 0.12;
  }
  if (player.x < 0) player.x = 0;
  if (player.x + player.w > WIDTH) player.x = WIDTH - player.w;
  updateAliens();
  updateBullets();
  updateCoins();
  checkCollisions();
  if (aliens.length === 0 && !gameOver) {
    level++;
    alienSpeed += 0.18;
    spawnAliens();
  }
}
function draw() {
  ctx.clearRect(0, 0, WIDTH, HEIGHT);
  drawStars();
  drawPlayer();
  drawAliens();
  drawBullets();
  drawCoins();
  drawHUD();
  if (gameOver) drawGameOver();
}

// START SCREEN
spawnStars();
introLoop();
</script>
</body>
</html>
